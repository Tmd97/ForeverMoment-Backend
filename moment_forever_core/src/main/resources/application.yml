# Server Configuration
server:
  port: 8080
  servlet:
    context-path: /api
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  tomcat:
    connection-timeout: 30000
    max-connections: 200
    threads:
      max: 50
      min-spare: 5

# Spring Boot Configuration
spring:
  application:
    name: moment-forever-platform


#    datasource:
#      url: jdbc:postgresql://localhost:5432/moment_forever_db
#      username: postgres
#      password: relay
#      driver-class-name: org.postgresql.Driver

    # Database Configuration - Postgres SQL
  datasource:
     url: jdbc:postgresql://ep-morning-king-ahlsqkrx-pooler.c-3.us-east-1.aws.neon.tech/moment_forever_db?sslmode=require&channel_binding=require
     username: neondb_owner
     password: npg_2reOZYBAa8Xb
     driver-class-name: org.postgresql.Driver

  # MongoDB Configuration - For GridFS File Storage (Images)
  data:
    mongodb:
      uri: mongodb://localhost:27017
      database: moment_forever
      # For cloud MongoDB like Atlas:
      # uri: mongodb+srv://username:password@cluster.mongodb.net/moment_forever_files

  # HikariCP Connection Pool Configuration
  hikari:
    pool-name: MomentForever-HikariPool
    connection-timeout: 30000
    maximum-pool-size: 20
    minimum-idle: 5
    idle-timeout: 600000
    max-lifetime: 1800000
    connection-test-query: SELECT 1
    auto-commit: false

  # JPA/Hibernate Configuration
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: update  # Options: validate | update | create | create-drop
    properties:
      hibernate:
#        dialect: org.hibernate.dialect.MySQL8Dialect
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          batch_size: 20
          order_inserts: true
          order_updates: true
        query:
          in_clause_parameter_padding: true
        id:
          new_generator_mappings: true
    show-sql: true
    open-in-view: false

  # File Upload Configuration
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB
      file-size-threshold: 2KB

  # Jackson Configuration
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
    deserialization:
      fail-on-unknown-properties: false
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: UTC
    default-property-inclusion: non_null

# Application Custom Configuration
app:
  base-url: http://localhost:8080
  file:
    upload-dir: ./uploads/
    max-size: 5242880  # 5MB
    allowed-extensions: jpg,jpeg,png,gif,webp
    serve-path: /uploads/**

# Slug Configuration
slug:
  separator: "-"
  max-length: 100

# Logging Configuration
# MOVED TO LOGBACK FILE

# ============================================
# JWT SECURITY CONFIGURATION
# ============================================
jwt:
  # Secret key for signing JWT tokens
  # MUST be at least 256 bits (32 characters)
  # In production, use environment variable: ${JWT_SECRET:default-secret-key}
  secret: "your-256-bit-secret-key-must-be-at-least-32-characters-long-here"

  # Token expiration times (in milliseconds)
  expiration: 86400000    # 24 hours = 24 * 60 * 60 * 1000
  refresh-expiration: 604800000  # 7 days = 7 * 24 * 60 * 60 * 1000

  # Token issuer (optional)
  issuer: "cherishx.com"

  # Token audience (optional)
  audience: "cherishx-web-app"

  # Cookie settings (if using cookie-based token storage)
  cookie:
    name: "auth_token"
    secure: true    # Send only over HTTPS in production
    http-only: true # Prevent XSS attacks
    max-age: 86400  # 24 hours in seconds

# ============================================
# APPLICATION SPECIFIC CONFIGURATION
# ============================================
  # CORS Configuration
  cors:
    allowed-origins:
      - "http://localhost:3000"  # React frontend
      - "http://localhost:4200"  # Angular frontend
    allowed-methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allowed-headers:
      - "Authorization"
      - "Content-Type"
      - "X-Requested-With"
    allow-credentials: true

  # Password Policy
  security:
    password:
      min-length: 8
      require-uppercase: true
      require-lowercase: true
      require-digits: true
      require-special-chars: true
      max-age-days: 90  # Force password change after 90 days

  # Rate Limiting (for production)
  rate-limit:
    login:
      max-attempts: 5
      window-minutes: 15
    registration:
      max-per-hour: 10
      max-per-ip: 50


# Actuator Endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
    endpoint:
      health:
        show-details: always
    probes:
      enabled: true
############## Swagger ########################
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    url: /v3/api-docs  # Explicitly tell Swagger UI where the JSON is
  api-docs:
    path: /v3/api-docs
    #http://localhost:8080/api/swagger-ui/index.html





# For GridFS bucket is here just a prefix for collection (table)
# it create two collection for files . one is [bucketname].files and [bucketname].chunks
# fs is the default bucket name, can give any one if use - in name have to use [] for getting documents
object:
  store:
    provider: gridfs
    gridfs-bucket: fs

---
# For S3
#object:
#  store:
#    provider: s3
#    s3-region: us-east-1
#    s3-bucket: my-app-images
#    s3-access-key: ${AWS_ACCESS_KEY}
#    s3-secret-key: ${AWS_SECRET_KEY}
    # s3-endpoint: http://localhost:4566  # For LocalStack